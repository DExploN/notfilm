<?	namespace controllers;	class testController extends \controller{		public function test($page=1){			/*			$films= new \models\films();			$ids=$films->select('id,links')->search('links','vkino');			foreach($ids as $row){				$url=$row['links'];				$data=@file_get_contents($url);				preg_match("/iframe src=\"(.*)\"/iU",$data,$match);				if($match[1]){					$films->update($row['id'],array('links'=>$match[1],'quality'=>0));				}			}			*/								}		public function findkpid($page=1){			$films= new \models\films();			$datafilm=$films->select('name,id,serial,year,ori')->where(array('show'=>'0','anime'=>'0','kpid'=>0))->limit(1)->getAll();			$datafilm=$datafilm[0];						$datafilm['name']=preg_replace("/\((.*)\)/iU","",$datafilm['name']);						$search.=$datafilm['name'];			if(!$datafilm['serial'] && $datafilm['year'])$search.=' '.$datafilm['year'];			if($datafilm['serial'])$search.=' сериал';			$search.=' '.$datafilm['ori'];			$search.=' кинопоиск site:kinopoisk.ru/film';						$yandexxml='https://yandex.ru/search/xml?user=notfilm&key=03.284875137:2b4712df51eec2efabcd601dea73df2f&l10n=ru&sortby=rlv&filter=none&groupby=attr%3D%22%22.mode%3Dflat.groups-on-page%3D10.docs-in-group%3D1';			$yandexxml.='&'.http_build_query(array('query'=>$search));			$xml=file_get_contents($yandexxml);			//var_dump($xml);			$obj=simplexml_load_string($xml);			$json = json_encode($obj);			$array = json_decode($json,TRUE);			$url=$array['response']['results']['grouping']['group'][0]['doc']['url'];			preg_match('/^http\:\/\/www\.kinopoisk\.ru\/film\/([0-9]+)\/(od\/1\/|vk\/1\/|fb\/1\/|.*|)$/i', $url, $matches);			//var_dump($matches[1]);			if($matches[1]){				$films->update($datafilm['id'],array('kpid'=>$matches[1]));			}else{				$films->update($datafilm['id'],array('kpid'=>'-1'));			}		}				public function getids(){			$films= new \models\films();			$datafilm=$films->select('kpid')->where(array('kpid >'=>0))->getAll();			foreach($datafilm as $row){				echo $row['kpid'].'<br />';			}		}				}?>