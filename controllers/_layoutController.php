<?	namespace controllers;			class _layoutController extends \controller{		public function main($data=array()){						$data['menu_genre_list']=\cache::read('/menu_genre_list/',function(){				$genre= new \models\genre();				return $genre->select('id,name,url')->whereNotIn(array('id'=>array(config('serialgenre_id'),config('showgenre_id'),config('animegenre_id'),config('multgenre_id'))))->where(array('anime'=>'0'))->orderby(array('name'=>'asc'))->getAll();			});							$year=date('Y');			for($i=0;$i<3;$i++){				$data['menu_year_list'][]=$year;				$year--;			}						/*			$films= new \models\films();			if(!$data['main_page']){				$data['menu_newfilms_list']=\cache::read('/menu_newfilms_list/',function(){					$films= new \models\films();					return $films->select('id,name,url')->orderBy(array('insertTimestamp'=>'desc'))->getAll(config('newfilms_count'));				});			}			*/			$data['menu_soonfilms_list']=\cache::read('/menu_soonfilms_list/',function(){				$films= new \models\films();				return $films->select('id,name,url')->where(array('dateRf >'=>date("Y-m-d"),'links'=>'','serial'=>'0','show'=>'0'))->orderBy(array('dateRf'=>'asc'))->getAll(config('soonfilms_count')*6);			});				shuffle($data['menu_soonfilms_list']);						$data['top_films_list']=\cache::read('/top_films_list/',function(){				$films= new \models\films();				return $films->select('id,name,url')->where(array('links !='=>'','dateRightholder'=>'0000-00-00','serial'=>'0','show'=>'0'))->orderBy(array('dateRf'=>'desc','updateTimestamp'=>'desc'))->getAll(config('topfilms_count'));			});										/*			$numtop=(int)$_COOKIE['numtop'];			$numtop=$numtop%5;			if(core()->route->action!==NULL)SetCookie("numtop",($numtop+1),time()+3600,"/");						$data['top_serials_list']=\cache::read('/top_serials_list/'.$numtop,function($numtop){				$numtop=(int)$numtop;				$films= new \models\films();				$numtop=$numtop*4;				return $films->select('id,name,url,lastSer,lastSerDate')->where(array('dateRf <='=>date("Y-m-d"),'serial'=>'1','dateRightholder'=>'0000-00-00','links !='=>''))->orderBy(array('updateTimestamp'=>'desc'))->getAll($numtop,4);			},array($numtop));										$data['top_show_list']=\cache::read('/top_show_list/'.$numtop,function($numtop){				$numtop=(int)$numtop;				$films= new \models\films();				$numtop=$numtop*4;				return $films->select('id,name,url,lastSer,lastSerDate')->where(array('dateRf <='=>date("Y-m-d"),'show'=>'1','dateRightholder'=>'0000-00-00','links !='=>''))->orderBy(array('updateTimestamp'=>'desc'))->getAll($numtop,4);			},array($numtop));			$data['top_anime_list']=\cache::read('/top_anime_list/'.$numtop,function($numtop){				$numtop=(int)$numtop;				$films= new \models\films();				$numtop=$numtop*4;				return $films->select('id,name,url,lastSer,lastSerDate')->where(array('dateRf <='=>date("Y-m-d"),'anime'=>'1','dateRightholder'=>'0000-00-00','links !='=>''))->orderBy(array('updateTimestamp'=>'desc'))->getAll($numtop,4);			},array($numtop));			*/									$data['menu_last_com']=\cache::read('/menu_last_com/',function(){				$com= new \models\comments();				return $com->getLastComs(config('last_com_count')*30);			});				shuffle($data['menu_last_com']);						$data['menu_selection_list']=\cache::read('/menu_selection_list/',function(){				$selection= new \models\selection();				return $selection->select('id,crop_name as name,url')->where(array('menu_rate >'=>0))->orderby(array('menu_rate'=>'desc'))->getAll();			});						if(user()->info('id')==1){				$pay=new \models\payments();				$data['count_orderlist']=$pay->where(array('status'=>'0'))->numRows();								$offer=new \models\offer();				$data['count_offerlist']=$offer->numRows();								$parsestatus= new \table('parsestatus');				$data['count_errorparse']=$parsestatus->where(array('status'=>'0'))->numRows();								$films= new \table('films');				$data['count_novideo']=$films->where(array('onlineStatus'=>'1','links'=>'','s_links'=>'','serial'=>'0','show'=>'0','anime'=>'0'))->numRows();				$data['count_changedonline']=$films->where(array('onlineStatus'=>'2'))->numRows();			}						core()->load('Mobile_Detect');						$detect = new \Mobile_Detect;			if ($detect->isMobile()) {				$data['isMobile']=true;			}						if(user()->isAuth()){				$payments=db()->getBySql("select `money`,`status` from `payments` where `user_login`='".user()->info('login')."' order by `timestamp` desc  limit 1 ");				if($payments['status']==0){					$data['payments']=$payments['money'];				}				$data['paymentstatus']=$payments['status'];			}			return $data;		}	}?>