<?	namespace controllers;	class offerController extends \controller{								public function order(){						if($_POST['name'] && $_COOKIE['offers']<config('maxoffer_count') && $_POST['text']){				setcookie ("offers", ($_COOKIE['offers']+1),(time()+3600*12), "/");				$offer= new \table('offer');				if($offer->where(array('ip'=>ip2long($_SERVER["REMOTE_ADDR"]),'timestamp >'=>date('Y-m-d H:i:s',(time()-3600*12))))->numrows()>config('maxoffer_count'))return false;											$_POST['name']=\str::crop(strip_tags($_POST['name']),200);				$_POST['text']=\str::crop(strip_tags($_POST['text']),1000);								$offer->insert(array('name'=>$_POST['name'],'text'=>$_POST['text'],'ip'=>ip2long($_SERVER["REMOTE_ADDR"]),'timestamp'=>date('Y-m-d H:i:s',(time()))));							}								}						public function listing($page=1){					$offer=new \models\offer();			$data['list']=$offer->getAllByPage($page,config('table_list_count'),$num);			$data['title']='Предложения';			$data['h1']='Предложения';			$data['noindex']='noindex';			$paginator = new \paginator($num,config('table_list_count'),$page);			$data['page']=$paginator->build();						$this->finalRender('order/list',$data);		}					public function orderoff(){						$id=(int)$_POST['id'];			if($id){				$offer= new \models\offer();				$offer->delete($id);			}			if($_POST['all']){				db()->delete('offer');				\msg::set('success','Все предложения удалены');			}				core()->backpage();					}				public function accessRules(){			return array(				'listing'=>(user()->info('id')==1),				'orderOff'=>(user()->info('id')==1),			);		}		public function captchaRules(){		return array();		}	}?>