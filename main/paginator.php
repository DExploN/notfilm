<?class paginator {		public $homePage;	public $allElls;	public $perPageCount;	public $curPage;	public $range=4;	public $get;	public $countGetParams;	public $name='page';	    public function __construct($allElls,$perPageCount,$curPage,$homePage=NULL) {        $this->homePage=$homePage;		$this->allElls=$allElls;		$this->perPageCount=$perPageCount;		$this->curPage=($curPage)?$curPage:1;		    }		public function build(){				if(!$this->homePage)$this->gHomePage($_SERVER['REQUEST_URI']);		$countpage=ceil($this->allElls/$this->perPageCount);		$firstRangePage=(($this->curPage-$this->range)>0)?($this->curPage-$this->range):1;		$lastRangePage=(($this->curPage+$this->range)>$countpage)?$countpage:($this->curPage+$this->range);				if($countpage>1){				$str="<div class='paginator'>";								if($firstRangePage>1)$str.="<a class='page firstpage' href='".$this->homePage."'>1</a><span>...</span>";		if($this->curPage>1){			$href=$this->homePage;				$i=$this->curPage-1;					if($i>1){					if(!$this->get){						$href.=$this->name."/$i/";					}else{						if($this->countGetParams){							$href.='&'.$this->name."=$i";						}else{							$href.='?'.$this->name."=$i";						}						}								}						$str.="<a class='page' href='$href'>Назад</a>";					}				for($i=$firstRangePage;$i<($lastRangePage+1);$i++){			$href=$this->homePage;						if($i!=1){				if(!$this->get){					$href.=$this->name."/$i/";				}else{					if($this->countGetParams){						$href.='&'.$this->name."=$i";					}else{						$href.='?'.$this->name."=$i";					}					}							}			if($i!=$this->curPage){				$str.="<a class='page' href='$href'>$i</a>";			}else{				$str.="<a class='page curpage' >$i</a>";			}					}				if($this->curPage<$countpage){			$href=$this->homePage;				$i=$this->curPage+1;					if($i>1){					if(!$this->get){						$href.=$this->name."/$i/";					}else{						if($this->countGetParams){							$href.='&'.$this->name."=$i";						}else{							$href.='?'.$this->name."=$i";						}						}								}						$str.="<a class='page' href='$href'>Вперед</a>";		}				if($lastRangePage<$countpage){			if(!$this->get){				$str.="<span>...</span><a  class='page lastpage' href='".$this->homePage.$this->name.'/'.$countpage."/'>$countpage</a>";			}else{				if($this->countGetParams){					$str.="<span>...</span><a class='page lastpage' href='".$this->homePage.'&'.$this->name."=".$countpage."'>$countpage</a>";				}else{					$str.="<span>...</span><a class='page lastpage' href='".$this->homePage.'?'.$this->name."=".$countpage."'>$countpage</a>";				}							}			}			$str.="</div>";		}		return $str;	}		public function gHomePage($url){		if(!$this->get){			if(preg_match("/(.*\/)".$this->name."\/[0-9]+\/$/i",$url,$matches)){				$this->homePage=$matches[1];			}else{				$this->homePage=$url;			}		}else{			$query=parse_url($url);			$path=$query['path'];			$query=$query['query'];			parse_str($query,$params);			if($params[$this->name]){				unset($params[$this->name]);				$this->countGetParams=count($params);				if(count($params)){					$this->homePage=$path."?".http_build_query($params);				}else{					$this->homePage=$path;				}			}else{				$this->countGetParams=count($params);				$this->homePage=$url;			}		}		return $this->homePage;	}}?>